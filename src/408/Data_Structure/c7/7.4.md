---
title: 7.4 B树与B+树
---
## 1. B树及其操作

### 1. B树的定义与查找
m阶B树就是所有结点的平衡因子均等于0的m路平衡查找树

![](/assets/img/shujv20.jpg)

B树满足以下特性：

1. 每个结点至多有m棵子树，即至多有m-1个关键字
2. 若根节点不是叶结点，则至少有2棵子树，即至少有1个关键字
3. 除根节点以外的所有非叶结点至少有$\lceil m/2\rceil$棵子树，即至少有$\lceil m/2 \rceil-1$个关键字
>防止每个结点内关键字变少，树变高，查找更多层结点，导致效率降低
4. 所有结点的平衡因子均为0
5. 所有的叶结点均在同一层上，且不带信息
6. 关键字及子树的值均有序排列

:::tip
含有实际数据的末路结点称作终端结点，而查找失败的结点称为叶子结点

一般来说，叶结点都会被定义成失败结点，但是真题会定义为终端结点
:::

B树的高度：

最小高度：$(m-1)(1+m+m^2+\cdots+m^{h-1})=m^h-1$，即$h\geq\log_m(n+1)$

最大高度：

n个关键字的B树必有n+1个叶子结点

即$n+1\geq 2(\lceil m/2\rceil)^{h-1}$，即$h\leq\log_{\lceil m/2\rceil}\frac{n+1}{2}+1$

整理得，含有n个关键字的m叉B树：

$$log_m(n+1)\leq h \leq \log_{\lceil m/2\rceil}\frac{n+1}{2}+1$$

m叉B树每个结点的关键字个数：

$\lceil m/2\rceil-1\leq n \leq m-1$

### 2. B树的插入

正常来说，直接按照二叉排序树的插入方式即可

可能会出现溢出的问题，这时候需要将此时溢出的第$\lceil m/2\rceil$个元素提取出来，将该元素左边的元素留在原结点，右边的元素提到右边，生成一个新结点，该元素提到根结点上，左右指针分别指向原结点和新建结点。

如果中间元素提到根节点后，同样出现了溢出问题，则嵌套处理；如果没有根节点，则新建一个

![](/assets/img/shujv21.jpg)


### 3. B树的删除

删除的情况较多，分为如下若干种情况

#### **删除的是终端结点**

直接删即可，然后按照如下内容判定：

如果删除后的结点关键字数量仍大于上限，则无事发生

若小于上限，则需要按照如下步骤走：

1. 检查删除关键字的左兄弟是否有多余关键字。若有，则依次将删除关键字的前驱、前驱的前驱往后挪一位
2. 检查删除关键字的右兄弟是否有多余关键字。若有，则依次将删除关键字的后继、后继的后继往前挪一位
3. 若左右兄弟都不够借，则左兄弟或右兄弟进行合并，即将位于根节点的前驱或后继抓下来，按照插入溢出的逆操作执行即可

![](/assets/img/shujv22.jpg)

#### **删除的是非终端结点**

按照二叉排序树的方法，找到该结点的直接前驱或直接后继，然后将其替代待删除结点，这样就转换为了删除终端结点的问题

## 2. B+树

B+树是应数据库所需而出现的一种B树的变种树，和B树有很大不同

![](/assets/img/shujv23.jpg)

B+树的条件：

+ 每个分支结点最多有m棵子树
+ 非叶根节点至少有2棵子树，其他每个分支节点至少有$\lceil m/2\rceil$棵子树
+ 结点的子树数量与关键字数量相等(一个关键字连出一棵子树)
+ 所有叶结点包含关键字及指向数据的指针
+ 叶结点有序排列，所有相邻叶结点有序相互链接(支持顺序查找)
+ 所有分支节点仅包含索引，不包含数据

B+树与B树的主要差异：


| 特性 | B树 | B+树 |
| --- | --- | ---- |
| 结点的**子树**数量 | 结点中n个关键字有n+1棵子树，即子树指针介于结点与结点之间 | 结点中n个关键字有n棵子树，即可以理解为子树直接由关键字引出|
| 结点的**关键字数量**范围 | $\lceil m/2\rceil-1\leq n \leq m-1$ | $\lceil m/2\rceil\leq n \leq m$ |
| **根节点**的关键字范围 | $1\leq n \leq m-1$ | $2\leq n \leq m$ |
| **叶结点**的信息重复性 | 终端节点与分支节点没有重复的关键字 | 叶结点与分支节点存在重复的关键字，叶结点包含了所有的关键字 | 
| **非叶结点**的作用 | 同样会存放信息，便于查找 | 所有非叶结点仅起索引作用 |
| **底部指针** | 不存在 | 存在一个链接所有叶结点的指针，便于进行顺序查找 |













